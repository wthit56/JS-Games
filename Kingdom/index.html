<!doctype html>
<script src="loadImage.js" type="text/javascript"></script>
<script src="drawImage.js" type="text/javascript"></script>
<script src="raf.js" type="text/javascript"></script>
<script src="time.js" type="text/javascript"></script>
<script src="sprite.js" type="text/javascript"></script>
<script src="fbf.js" type="text/javascript"></script>

<script src="king.js" type="text/javascript"></script>
<script src="terrain.js" type="text/javascript"></script>

<body></body>
<div id="controls">
	<label for="speed">Speed:</label><input type="range" value="1" min="0.1" max="3" step="0.1" oninput="speedChange = this.value;" id="speed" /><span id="speed-value">1</span><input type="button" value="Reset" onclick="var s = document.getElementById('speed'); s.value = 1; s.oninput();" />
</div>

<script type="text/javascript">
	var canvas = document.createElement("CANVAS"), ctx = canvas.getContext("2d");
	canvas.width = canvas.height = 100;
	canvas.style.cssText = "image-rendering:pixelated; border:inset; width:400px; height:400px;";
	
	var t = time();
	var loaded = false;
	var speedChange = NaN;

	loadImage("graphics/%f.png", ["king", "cobblestones"], function imagesLoaded(p) {
		king.init(t.time, p.images["king"]);
		terrain.init(t.time, p.images["cobblestones"]);
		loaded = true;
	});
	
	function frame(now) {
		// console.log("frame", now);
		t.update(now);
		// console.log(time.time);
		
		canvas.width = canvas.width; // clear canvas
		
		if (!isNaN(speedChange)) {
			// console.log("speed", speedChange);
			t.setSpeed(now, speedChange);
			document.getElementById("speed-value").innerText = speedChange;
			speedChange = NaN;
		}
		
		if (loaded) {
			king.update(t.time);
			terrain.update(t.time);
			
			terrain.draw.back(ctx);
			king.draw(ctx);
			terrain.draw.front(ctx);
		}
		
		raf(frame);
	}
	
	window.addEventListener("load", function() {
		document.body.appendChild(canvas);
		document.body.appendChild(document.getElementById("controls"));
		raf(frame);
	});
</script>