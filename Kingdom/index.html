<!doctype html>
<script src="loadImage.js" type="text/javascript"></script>
<script src="drawImage.js" type="text/javascript"></script>
<script src="raf.js" type="text/javascript"></script>
<script src="time.js" type="text/javascript"></script>
<script src="sprite.js" type="text/javascript"></script>
<script src="fbf.js" type="text/javascript"></script>

<script src="king.js" type="text/javascript"></script>
<script src="terrain.js" type="text/javascript"></script>

<script type="text/javascript">
	var canvas = document.createElement("CANVAS"), ctx = canvas.getContext("2d");
	canvas.width = canvas.height = 100;
	canvas.style.cssText = "image-rendering:pixelated; border:inset";
	
	var t = time();
	var loaded = false;

	loadImage("graphics/%f.png", ["king", "cobblestones"], function imagesLoaded(p) {
		t.update(performance.now());
		king.init(t.time, p.images["king"]);
		terrain.init(t.time, p.images["cobblestones"]);
		loaded = true;
	});
	
	window.addEventListener("load", function() {
		document.body.appendChild(canvas);
		(function frame(now) {
			t.update(now);
			// console.log(time.time);
			
			canvas.width = canvas.width; // clear canvas
			
			if (loaded) {
				king.update(t.time);
				terrain.update(t.time);
				
				terrain.draw.back(ctx);
				king.draw(ctx);
				terrain.draw.front(ctx);
			}
			
			raf(frame);
		})(performance.now());
	});
</script>