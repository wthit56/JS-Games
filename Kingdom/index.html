<!doctype html>
<script src="loadImage.js" type="text/javascript"></script>
<script src="drawImage.js" type="text/javascript"></script>
<script src="raf.js" type="text/javascript"></script>
<script src="sprite.js" type="text/javascript"></script>
<script src="fbf.js" type="text/javascript"></script>

<script src="king.js" type="text/javascript"></script>
<script src="terrain.js" type="text/javascript"></script>

<script type="text/javascript">
	var canvas = document.createElement("CANVAS"), ctx = canvas.getContext("2d");
	canvas.width = 100;
	canvas.style.cssText = "image-rendering:pixelated";
	
	var loaded = false;

	loadImage("graphics/%f.png", ["king", "cobblestones"], function imagesLoaded(p) {
		var time = performance.now();
		
		king.init(time, p.images["king"]);
		terrain.init(time, p.images["cobblestones"]);
		loaded = true;
	});
	
	window.addEventListener("load", function() {
		document.body.appendChild(canvas);
		var timeLast = 0, timeDiff;
		(function frame(time) {
			canvas.width = canvas.width; // clear canvas
			timeDiff = time - timeLast;
			
			if (loaded) {
				king.update(timeDiff, time);
				terrain.update(timeDiff, time);
				
				terrain.draw.back(ctx);
				king.draw(ctx);
				terrain.draw.front(ctx);
			}
			
			timeLast = time;
			
			raf(frame);
		})(0);
	});
</script>